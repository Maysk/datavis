<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>D3 + crossfilter + dc.js</title>
    <link rel="stylesheet" href="css/dc.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="js/crossfilter.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/dc.js" charset="utf-8"></script>

</head>
<body>
    <h1>D3 + crossfilter + dc.js</h1><small><a href="../index.html">Voltar</a></small> 
    <hr/>
    <div id="chart1" style="width:50%"><p class = "lead">Total apurado nas
bilheterias para cada ano</p></div>
    
    <div id="chart2" style="width:50%"><p class = "lead">Total apurado por
GÃªnero de filme</p></div>

	<script type="text/javascript">
        var barChart1 = dc.barChart("#chart1");
        var barChart2 = dc.barChart("#chart2");

        d3.json('movies.json', function(data){
            data.forEach(function(d){
                d.Year = +d.Year;
                d.Worldwide_Gross_M = +d.Worldwide_Gross_M;
                d.Budget_M = +d.Budget_M;
            });
            

            var facts = crossfilter(data);          
            
            var yearDim = facts.dimension(
                function(d){
                    return d.Year
                });

            var genreDim = facts.dimension(
                function(d){
                    return d.Genre;
                });

            var totalByYear = yearDim.group().reduceSum(
                function(d){
                    return d.Worldwide_Gross_M;
                });

            var totalByGenre = genreDim.group().reduceSum(
                function(d){
                    return d.Worldwide_Gross_M;
                });

            console.log(totalByGenre.all());
            barChart1.width(450)
                .height(500)
                .margins({top:0, right:50, bottom:20, left:40})
                .dimension(yearDim)
                .group(totalByYear)
                .gap(5)
                .x(d3.scale.ordinal().domain([2007,2008,2009,2010,2011]))
                .xUnits(dc.units.ordinal)
                .renderHorizontalGridLines(true);

            var sortedGenre = totalByGenre.all().sort(function(a,b){return a.value < b.value});
            var genreSortedNames = sortedGenre.map(function(d){return d.key});

            //var genreNames = data.map(function(d){return d.Genre;});

            barChart2.width(450)
                .height(500)
                .margins({top:0, right:50, bottom:20, left:40})
                .dimension(genreDim)
                .group(totalByGenre)
                .gap(5)
                .x(d3.scale.ordinal().domain(genreSortedNames))
                .xUnits(dc.units.ordinal)
                .renderHorizontalGridLines(true);

            dc.renderAll();
        });
	</script>			
</body>
</html>